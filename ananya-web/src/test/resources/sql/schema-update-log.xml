<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet context="setup" author="ThoughtWorks-version1.1" id="1">
        <sql>
            update
            report.course_item_measure
            set
            location_id = ( select
            location_id
            from
            report.registration_measure
            where
            course_item_measure.flw_id = registration_measure.flw_id
            )
        </sql>

        <sql>
            update
            report.call_duration_measure
            set
            location_id = ( select
            location_id
            from
            report.registration_measure
            where
            call_duration_measure.flw_id = registration_measure.flw_id
            )
        </sql>

        <sql>
            update
            report.sms_sent_measure
            set
            location_id = ( select
            location_id
            from
            report.registration_measure
            where
            sms_sent_measure.flw_id = registration_measure.flw_id
            )
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="2">
        <sql>
            update
            report.front_line_worker_dimension
            set designation = 'AWW'
            where msisdn in (919576026237,919934240573,919304598102 )

        </sql>

        <sql>
            update
            report.front_line_worker_dimension
            set designation = 'ASHA'
            where msisdn in (
            918873529527,919604792647,919931877016,919801894047,919693173091,919006944511,
            919263672067,919931113401,919006241272,918757906652,919204535979,919852750820,
            919386658281,919608941924,919204732885,919204299341,919097266325,918969106817,
            911962682332,919931664833,919801925937,919661296050,918809853323,919798444042,
            919939673406,919955696356,919801699362,918084983894,919825882760,919331040084,
            919304263073,919939623914,918434490448,919973094719,919939599071,919234215178,
            918651416161,919204385105,919661759772,919308559317,919304216561,919525986648
            )
        </sql>

        <sql>
            update
            report.front_line_worker_dimension
            set designation = 'ANM'
            where msisdn in (
            919162129169,918801894047,918809663088,919304041322,919801199499,919708180816,
            919534872337,919708844520,917739287514,919661555975,919334321625,919801693144,
            919430172212,919939370517,919534820564,919431693384,918877788609,919431767865,
            919507904660,919835637904,919608067586,918298776305,919199032380,917352424325,
            919934217214,919430086440,919162992021,919661572240,919430981098,919973647457,
            919771115932,919472371250,917631383639,918051526413,918877881085,919570592199,
            919570856082,919430618751,918292401304,918969992698,919934294846,919939988858,
            919204726405,919608065822,919570436983
            )
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="3">
        <sql>
            update
            report.front_line_worker_dimension
            set designation = null
            where designation = 'INVALID'
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="4">
        <sql>
            update
            report.front_line_worker_dimension
            set designation = null
            where designation = ''
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="5">
        <createTable tableName="temp_content_correction" schemaName="report">
            <column name="id" type="serial">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="content_name" type="varchar(255)"/>
            <column name="incorrect_duration" type="int"/>
            <column name="correct_duration" type="int"/>
        </createTable>

        <sql>
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0011_ch1_qp.wav', 96289, 24819 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0011_ch1_qp.wav', 96289, 23869 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0011_ch1_qp.wav', 96289, 21375 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0011_ch1_qp.wav', 96289, 28974 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0011_ch1_qp.wav', 96289, 29437 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0038_ch2_qp.wav', 16660, 25247 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0038_ch2_qp.wav', 16660, 25072 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0038_ch2_qp.wav', 16660, 21255 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0038_ch2_qp.wav', 16660, 28813 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0038_ch2_qp.wav', 16660, 29741 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0065_ch3_qp.wav', 16448, 24785 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0065_ch3_qp.wav', 16448, 23817 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0065_ch3_qp.wav', 16448, 21260 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0065_ch3_qp.wav', 16448, 28571 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0065_ch3_qp.wav', 16448, 28535 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0092_ch4_qp.wav', 16800, 24957 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0092_ch4_qp.wav', 16800, 24772 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0092_ch4_qp.wav', 16800, 23234 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0092_ch4_qp.wav', 16800, 30338 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0092_ch4_qp.wav', 16800, 30513 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0119_ch5_qp.wav', 16471, 25007 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0119_ch5_qp.wav', 16471, 24604 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0119_ch5_qp.wav', 16471, 21673 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0119_ch5_qp.wav', 16471, 28846 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0119_ch5_qp.wav', 16471, 29509 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0146_ch6_qp.wav', 16969, 24081 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0146_ch6_qp.wav', 16969, 23740 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0146_ch6_qp.wav', 16969, 20782 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0146_ch6_qp.wav', 16969, 27046 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0146_ch6_qp.wav', 16969, 28666 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0173_ch7_qp.wav', 16769, 24969 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0173_ch7_qp.wav', 16769, 24029 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0173_ch7_qp.wav', 16769, 21427 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0173_ch7_qp.wav', 16769, 27792 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0173_ch7_qp.wav', 16769, 28658 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0200_ch8_qp.wav', 16493, 23677 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0200_ch8_qp.wav', 16493, 23434 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0200_ch8_qp.wav', 16493, 20069 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0200_ch8_qp.wav', 16493, 27984 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0200_ch8_qp.wav', 16493, 28709 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 0:0227_ch9_qp.wav', 16668, 24847 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 1:0227_ch9_qp.wav', 16668, 24509 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 2:0227_ch9_qp.wav', 16668, 21575 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 3:0227_ch9_qp.wav', 16668, 28718 );
            insert into report.temp_content_correction ( content_name, incorrect_duration, correct_duration) VALUES ( 'score 4:0227_ch9_qp.wav', 16668, 28422 );
        </sql>
        <sql>
            update
                report.course_item_dimension
            set
                duration = (
                    select
                        tcc.correct_duration
                    from
                        report.temp_content_correction tcc
                    where
                        tcc.content_name = name
                )
                where
                    name in (
                        select
                            tcc.content_name
                        from
                            report.temp_content_correction tcc
                    )
        </sql>
        <sql>
            update
                report.course_item_measure
            set
                percentage = round(duration * 100.0 / (select duration from report.course_item_dimension cid where cid.id = course_item_id))
            where
                course_item_id in (
                    select
                        cid.id
                    from
                        report.course_item_dimension cid join
                        report.temp_content_correction tcc on tcc.content_name = cid.name
                )
        </sql>
        <sql>
            drop table report.temp_content_correction;
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="6">
        <sql>
           update report.location_dimension set panchayat = null where panchayat =''
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.3" id="7">
        <sql>
           update report.call_duration_measure set called_number = 5771102
           where type = 'CERTIFICATECOURSE'
           and called_number &lt;&gt; 33578057
        </sql>
        <sql>
            update report.call_duration_measure set called_number = 5771102
            where id in
                (
                select cdm1.id from report.call_duration_measure cdm1
                inner join report.call_duration_measure cdm2 on cdm1.call_id = cdm2.call_id
                where cdm1.type='CALL'
                and cdm2.type='CERTIFICATECOURSE'
                and cdm2.called_number &lt;&gt; 33578057
                )
        </sql>
        <sql>
            update report.call_duration_measure set called_number = to_number(substring(trim(to_char(called_number,'9999999999999999999999999999')) from 1 for 7),'9999999')
            where type in ('JOBAID', 'CALL')
            and called_number &gt; 5771199
            and called_number not in(33578056, 33578057)
        </sql>
        <sql>
            update report.call_duration_measure set called_number = 57711
            where called_number not in (select distinct short_code from report.job_aid_content_dimension where short_code is not null)
            and called_number not in(33578056, 33578057, 5771102)
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.4" id="8">
        <sql>
            update report.call_duration_measure cdm set location_id = ( select location_id from report.registration_measure rm where rm.flw_id = cdm.flw_id order by id desc limit 1) where location_id != ( select location_id from report.registration_measure rm where rm.flw_id = cdm.flw_id order by id desc limit 1);

            update report.course_item_measure cim set location_id = ( select location_id from report.registration_measure rm where rm.flw_id = cim.flw_id order by id desc limit 1) where location_id != ( select location_id from report.registration_measure rm where rm.flw_id = cim.flw_id order by id desc limit 1);

            update report.job_aid_content_measure jacm set location_id = ( select location_id from report.registration_measure rm where rm.flw_id = jacm.flw_id order by id desc limit 1) where location_id != ( select location_id from report.registration_measure rm where rm.flw_id = jacm.flw_id order by id desc limit 1);

            update report.sms_sent_measure smsm set location_id = ( select location_id from report.registration_measure rm where rm.flw_id = smsm.flw_id order by id desc limit 1) where location_id != ( select location_id from report.registration_measure rm where rm.flw_id = smsm.flw_id order by id desc limit 1);
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.10" id="9">
        <sql>
            UPDATE
            report.course_item_dimension AS cid
            SET
            duration = 20047
            WHERE
            file_name = '0245_ch9_end_op.wav'
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.10" id="10">
        <sql>
            UPDATE
            report.call_duration_measure AS cdm
            SET
            time_id = td2.id
            FROM
            report.time_dimension td1,
            report.time_dimension td2
            WHERE
            cdm.time_id = td1.id
            AND td1.date != date_trunc('day',cdm.start_time)
            AND td2.date = date_trunc('day',cdm.start_time)
        </sql>

        <sql>
            UPDATE
            report.course_item_measure AS cim
            SET
            time_id = td2.id
            FROM
            report.time_dimension td1,
            report.time_dimension td2
            WHERE
            cim.time_id = td1.id
            AND td1.date != date_trunc('day',cim.timestamp)
            AND td2.date = date_trunc('day',cim.timestamp)
        </sql>

        <sql>
            UPDATE
            report.job_aid_content_measure AS jacm
            SET
            time_id = td2.id
            FROM
            report.time_dimension td1,
            report.time_dimension td2
            WHERE
            jacm.time_id = td1.id
            AND td1.date != date_trunc('day',jacm.timestamp)
            AND td2.date = date_trunc('day',jacm.timestamp)
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.10" id="11">
        <sql>
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'airtel');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'bsnl');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'reliance');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'vodafone');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'tata');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'idea');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'undefined');
            update report.call_duration_measure set duration_in_pulse = ceil(duration / 60.0) where flw_id in (select id from report.front_line_worker_dimension where operator = 'longcode');
        </sql>
    </changeSet>

    <changeSet context="setup" author="ThoughtWorks-version1.10" id="12">
        <sql>
            update report.call_duration_measure set duration_in_pulse = 1 where duration=0;
        </sql>
    </changeSet>
</databaseChangeLog>